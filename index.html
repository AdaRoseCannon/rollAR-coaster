<html>

<head>
	<script src="./aframe.js"></script>
	<script src="./curve.js"></script>
	<script src="./roller-coaster.js"></script>
	<script src="https://unpkg.com/aframe-environment-component@1.2.0/dist/aframe-environment-component.min.js"></script>
	<title>RollAR Coaster</title>
	<style>
		body {
			font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
		}
	</style>
</head>

<body>
	<a-scene
		webxr="overlayElement:#dom-overlay;"
		background="directionalLight:#dirlight;"
		ar-hit-test
		shadow="type: pcfsoft"
		gltf-model="dracoDecoderPath: https://cdn.jsdelivr.net/npm/three@0.129.0/examples/js/libs/draco/gltf/;"
	>
		<a-assets>
			<!-- model by Snooze https://sketchfab.com/3d-models/low-poly-table-b940256ec5994e26a9e71289d1211b19 -->
			<a-asset-item id="cart-glb" src="./cart.glb"></a-asset-item>
			<a-asset-item id="flag-glb" src="./flag.glb"></a-asset-item>
			<a-asset-item id="tracks-glb" src="./tracks.glb"></a-asset-item>
		</a-assets>

		<a-light id="dirlight" intensity="0.7" light="castShadow:true;type:directional" position="1 1 1"></a-light>
		<a-light hide-on-enter-ar intensity="0.3" light="type:hemisphere;color:yellow;groundColor:blue;"
			position="1 1 1"></a-light>

		<a-entity hide-on-enter-ar environment="lighting:none;shadow:true;"></a-entity>

		<a-box position="-3 0.15 -6" scale="0.5 0.3 0.5"></a-box>
		<a-curve position="0 0.1 0" closed="true" clone-along-curve="spacing: 0.16;" gltf-model="#tracks-glb">
			<a-curve-point position="0 0 -3" gltf-model="#flag-glb"></a-curve-point>
			<a-curve-point position="-3 0.3 -6" gltf-model="#flag-glb"></a-curve-point>
			<a-curve-point position="0 0 -9" gltf-model="#flag-glb"></a-curve-point>
			<a-curve-point position="3 0 -6" gltf-model="#flag-glb"></a-curve-point>

			<a-gltf-model src="#cart-glb" roller-coaster="curve:a-curve;"></a-gltf-model>
		</a-curve>
	</a-scene>

	<div id="dom-overlay">
		<h1>Rollar Coaster</h1>
		<p id="dom-overlay-message">Enter AR to start.</p>
	</div>
	<script>(function () {
		const sceneEl = document.querySelector('a-scene');
		const message = document.getElementById('dom-overlay-message');

		sceneEl.addEventListener('enter-vr', function () {
			if (this.is('ar-mode')) {
				message.textContent = '';

				this.addEventListener('ar-hit-test-start', function () {
					message.innerHTML = `Scanning environment, finding surface.`
				}, { once: true });

				this.addEventListener('ar-hit-test-achieved', function () {
					message.innerHTML = `Select the location to place the furniture<br />By tapping on the screen or selecting with your controller.`
				}, { once: true });

				this.addEventListener('ar-hit-test-select', function () {
					message.textContent = '';
				}, { once: true });
			}
		});

		sceneEl.addEventListener('exit-vr', function () {
			message.textContent = '';
		});
	
	}())</script>
</body>

</html>
